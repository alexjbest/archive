---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/Diagnosing.20timeout.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html">Diagnosing timeout</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="195833392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195833392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195833392">(Apr 30 2020 at 12:46)</a>:</h4>
<p>I'm getting a confusing deterministic timeout - with the last line of my proof there's a timeout but without it there isn't, and if I reorder the proof to have a different last line, still the last line gives a timeout. I haven't used anything like simp or tidy, and I'm pretty sure there shouldn't be any difficult typeclass searches either. What sort of thing could I do to figure out why it's timing out? (I can't really post an MWE since it's on top of thousands of lines of topos code but the proof is:</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">sheaf_exponential</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">sheaf</span> <span class="n">C</span> <span class="n">j</span><span class="o">)</span> <span class="o">:</span> <span class="n">sheaf</span> <span class="n">C</span> <span class="n">j</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">A</span> <span class="o">:=</span> <span class="n">exp</span> <span class="n">A</span> <span class="n">s</span><span class="bp">.</span><span class="n">A</span><span class="o">,</span>
  <span class="n">unique_extend</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">B</span> <span class="n">B&#39;</span> <span class="n">m</span> <span class="n">f&#39;</span> <span class="n">d</span><span class="o">,</span>
  <span class="k">begin</span>
    <span class="n">haveI</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">dense_prod_map_id</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">j</span> <span class="bp">_</span> <span class="n">A</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">m</span> <span class="n">d</span><span class="o">,</span>
    <span class="n">refine</span> <span class="bp">⟨⟨⟨</span><span class="n">cchat</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="bp">_⟩⟩</span><span class="o">,</span> <span class="bp">_⟩</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="err">←</span> <span class="n">exp_transpose_natural_left</span><span class="o">,</span>
      <span class="n">rw</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span>
      <span class="n">exact</span> <span class="o">((</span><span class="n">exp</span><span class="bp">.</span><span class="n">adjunction</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">hom_equiv</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">right_inv</span> <span class="n">f&#39;</span> <span class="o">},</span>
    <span class="n">rintro</span> <span class="bp">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="k">have</span> <span class="n">z</span> <span class="o">:</span> <span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span> <span class="err">≫</span> <span class="n">unhat</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">,</span>
      <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">exp_transpose_natural_left_symm</span> <span class="n">m</span> <span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="o">],</span>
    <span class="n">rw</span> <span class="err">←</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">⟨</span><span class="n">unhat</span> <span class="n">a</span><span class="o">,</span> <span class="n">z</span><span class="bp">⟩</span><span class="o">,</span>
    <span class="n">congr</span><span class="o">,</span>
    <span class="n">symmetry</span><span class="o">,</span>
    <span class="n">refine</span> <span class="o">((</span><span class="n">exp</span><span class="bp">.</span><span class="n">adjunction</span> <span class="n">A</span><span class="o">)</span><span class="bp">.</span><span class="n">hom_equiv</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">right_inv</span> <span class="n">a</span><span class="o">,</span>
  <span class="kn">end</span>
<span class="o">}</span>
</code></pre></div>



<a name="195833617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195833617" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195833617">(Apr 30 2020 at 12:49)</a>:</h4>
<p>I'm not sure if it makes a difference but the proof of <code>dense_prod_map_id</code> is currently sorry</p>



<a name="195833653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195833653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195833653">(Apr 30 2020 at 12:49)</a>:</h4>
<p>and without the final line of the proof, it's very quick to show me the tactic state</p>



<a name="195833884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195833884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195833884">(Apr 30 2020 at 12:51)</a>:</h4>
<p>are there other fields of <code>sheaf</code> you haven't provided?</p>



<a name="195833898"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195833898" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195833898">(Apr 30 2020 at 12:51)</a>:</h4>
<p>Nope</p>



<a name="195834909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195834909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195834909">(Apr 30 2020 at 13:01)</a>:</h4>
<p>You can try turning on various trace flags, and see whether anything looks obviously out of control. Otherwise, I am afraid it's not easy to tell what's going on</p>



<a name="195835003"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195835003" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195835003">(Apr 30 2020 at 13:01)</a>:</h4>
<p>One possibility is that you actually have a type error and Lean is going on an unfolding spree to see if it can be reduced away</p>



<a name="195835097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195835097" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195835097">(Apr 30 2020 at 13:02)</a>:</h4>
<p>Are there any trace flags I should try first? <code>trace.class_instances</code> didn't seem out of control</p>



<a name="195835237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195835237" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195835237">(Apr 30 2020 at 13:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195835003" title="#narrow/stream/113488-general/topic/Diagnosing.20timeout/near/195835003">said</a>:</p>
<blockquote>
<p>One possibility is that you actually have a type error and Lean is going on an unfolding spree to see if it can be reduced away</p>
</blockquote>
<p>This makes sense, but if I reorder the proof (eg changing the <code>have z</code> to a <code>suffices</code>) there's no type error for the alternative last line</p>



<a name="195835283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195835283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195835283">(Apr 30 2020 at 13:04)</a>:</h4>
<p>For clarity, by reordered proof I mean:</p>
<div class="codehilite"><pre><span></span><code><span class="n">def</span> <span class="n">sheaf_exponential</span> <span class="o">(</span><span class="n">A</span> <span class="o">:</span> <span class="n">C</span><span class="o">)</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">sheaf</span> <span class="n">C</span> <span class="n">j</span><span class="o">)</span> <span class="o">:</span> <span class="n">sheaf</span> <span class="n">C</span> <span class="n">j</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">A</span> <span class="o">:=</span> <span class="n">exp</span> <span class="n">A</span> <span class="n">s</span><span class="bp">.</span><span class="n">A</span><span class="o">,</span>
  <span class="n">unique_extend</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">B</span> <span class="n">B&#39;</span> <span class="n">m</span> <span class="n">f&#39;</span> <span class="n">d</span><span class="o">,</span>
  <span class="k">begin</span>
    <span class="n">haveI</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">dense_prod_map_id</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">j</span> <span class="bp">_</span> <span class="n">A</span> <span class="bp">_</span> <span class="bp">_</span> <span class="n">m</span> <span class="n">d</span><span class="o">,</span>
    <span class="n">refine</span> <span class="bp">⟨⟨⟨</span><span class="n">cchat</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="o">,</span> <span class="bp">_⟩⟩</span><span class="o">,</span> <span class="bp">_⟩</span><span class="o">,</span>
    <span class="o">{</span> <span class="n">rw</span> <span class="err">←</span> <span class="n">exp_transpose_natural_left</span><span class="o">,</span>
      <span class="n">rw</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">1</span><span class="bp">.</span><span class="mi">2</span><span class="o">,</span>
      <span class="n">exact</span> <span class="o">((</span><span class="n">exp</span><span class="bp">.</span><span class="n">adjunction</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">hom_equiv</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">right_inv</span> <span class="n">f&#39;</span> <span class="o">},</span>
    <span class="o">{</span> <span class="n">rintro</span> <span class="bp">⟨</span><span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="bp">⟩</span><span class="o">,</span>
      <span class="n">suffices</span> <span class="n">z</span> <span class="o">:</span> <span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span> <span class="err">≫</span> <span class="n">unhat</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">,</span>
        <span class="n">rw</span> <span class="err">←</span> <span class="o">(</span><span class="n">s</span><span class="bp">.</span><span class="n">unique_extend</span> <span class="o">(</span><span class="n">limits</span><span class="bp">.</span><span class="n">prod</span><span class="bp">.</span><span class="n">map</span> <span class="o">(</span><span class="mi">𝟙</span> <span class="n">A</span><span class="o">)</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">unhat</span> <span class="n">f&#39;</span><span class="o">))</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">⟨</span><span class="n">unhat</span> <span class="n">a</span><span class="o">,</span> <span class="n">z</span><span class="bp">⟩</span><span class="o">,</span>
        <span class="n">congr</span><span class="o">,</span>
        <span class="n">symmetry</span><span class="o">,</span>
        <span class="n">refine</span> <span class="o">((</span><span class="n">exp</span><span class="bp">.</span><span class="n">adjunction</span> <span class="n">A</span><span class="o">)</span><span class="bp">.</span><span class="n">hom_equiv</span> <span class="bp">_</span> <span class="bp">_</span><span class="o">)</span><span class="bp">.</span><span class="n">right_inv</span> <span class="n">a</span><span class="o">,</span>
      <span class="n">rw</span> <span class="o">[</span><span class="err">←</span> <span class="n">exp_transpose_natural_left_symm</span> <span class="n">m</span> <span class="n">a</span><span class="o">,</span> <span class="n">ha</span><span class="o">],</span>
    <span class="o">}</span>
  <span class="kn">end</span>
<span class="o">}</span>
</code></pre></div>



<a name="195835390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195835390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bhavik Mehta <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195835390">(Apr 30 2020 at 13:04)</a>:</h4>
<p>In both cases commenting out the last line (in the latter case, just the <code>ha</code>) tells me quickly that the goal isn't solved and there's no other errors</p>



<a name="195835402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/Diagnosing%20timeout/near/195835402" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/Diagnosing.20timeout.html#195835402">(Apr 30 2020 at 13:04)</a>:</h4>
<p>maybe <code>set_option trace.type_context.is_def_eq true</code></p>



{% endraw %}

<hr><p>Last updated: Apr 30 2020 at 13:05 UTC</p>