---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/widget.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html">widget</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="196758988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/widget/near/196758988" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html#196758988">(May 07 2020 at 11:47)</a>:</h4>
<p>Hi everyone, I've built a prototype functional UI framework for lean that you can try out here: <a href="https://demo.edayers.com" title="https://demo.edayers.com">https://demo.edayers.com</a><br>
It's still very much WIP but I thought I would share it here now because I am now happy with it as a proof of concept.<br>
The idea is that you can use <code>widget.component</code> and <code>widget.html</code> to build a virtual HTML tree in Lean (with support for stateful components).<br>
There is a new constant called <code>save_widget</code> which performs the analogue of <code>save_info_thunk</code>. If this is called, then instead of rendering the goal state, the editor will render an interactive widget.  It is also possible for the widget to send commands to the editor.<br>
This means that it is possible to make an interactive UI for tactic states (eg you could click on a goal and it would give you a list of available tactics) entirely within lean, without having to write any javascript or C++.<br>
The UI building API is still very rough and subject to change.</p>
<p>The source code is on a branch called 'widget'  in the following places: </p>
<ul>
<li>lean: <a href="https://github.com/EdAyers/lean/tree/widget" title="https://github.com/EdAyers/lean/tree/widget">https://github.com/EdAyers/lean/tree/widget</a></li>
<li>vscode extension: <a href="https://github.com/EdAyers/vscode-lean/tree/widget" title="https://github.com/EdAyers/vscode-lean/tree/widget">https://github.com/EdAyers/vscode-lean/tree/widget</a></li>
<li>lean-web-editor: <a href="https://github.com/EdAyers/lean-web-editor/tree/widget" title="https://github.com/EdAyers/lean-web-editor/tree/widget">https://github.com/EdAyers/lean-web-editor/tree/widget</a><br>
Also massive thanks to <span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span> for helping me get the emscripten build working!</li>
</ul>



<a name="196759477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/widget/near/196759477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html#196759477">(May 07 2020 at 11:53)</a>:</h4>
<p>So apparently this can be used to implement go-to-definition in the goal view.  And it should also be possible to implement a feature where you can click on a subterm and it expands the implicit arguments.</p>



<a name="196759709"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/widget/near/196759709" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html#196759709">(May 07 2020 at 11:56)</a>:</h4>
<p>Yep, go-to-definition would require writing a hook in the client editor but subterm implicit arguments is straightforward. The tooltip message is generated by lean and it has the full tactic state and subexpression to work with when generating the UI.</p>



<a name="196760259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/widget/near/196760259" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html#196760259">(May 07 2020 at 12:02)</a>:</h4>
<blockquote>
<p>And it should also be possible to implement a feature where you can click on a subterm and it expands the implicit arguments.</p>
</blockquote>
<p>I would love to have something similar to <a href="https://blog.jetbrains.com/scala/2018/07/25/intellij-scala-plugin-2018-2-advanced-implicit-support-improved-patterns-autocompletion-semantic-highlighting-scalafmt-and-more/" title="https://blog.jetbrains.com/scala/2018/07/25/intellij-scala-plugin-2018-2-advanced-implicit-support-improved-patterns-autocompletion-semantic-highlighting-scalafmt-and-more/">IntelliJ's Scala Plugin's "show implicits"</a>.</p>
<p>The other IntelliJ feature that I'd love to have is to select a subexpression (not just a single word) and to get the type of the whole subexpression.</p>
<p>... and "reverse go to definition" which finds all uses of a definition in the codebase.</p>



<a name="196760428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/widget/near/196760428" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html#196760428">(May 07 2020 at 12:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="115715">Jason Rute</span> <a href="#narrow/stream/113488-general/topic/widget/near/196760259" title="#narrow/stream/113488-general/topic/widget/near/196760259">said</a>:</p>
<blockquote>
<p>The other IntelliJ feature that I'd love to have is to select a subexpression (not just a single word) and to get the type of the whole subexpression.</p>
</blockquote>
<p>That works on the demo right now.</p>



<a name="196760466"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/widget/near/196760466" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html#196760466">(May 07 2020 at 12:05)</a>:</h4>
<p>Oooh, this is slick!</p>



<a name="196760559"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/widget/near/196760559" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html#196760559">(May 07 2020 at 12:06)</a>:</h4>
<p>Only, when I have the counter, I don't see any other goal state anymore. And after the <code>split</code>, I only have 1 counter, whereas I interpret the comments as saying that I should see two. Is that right?</p>



<a name="196760600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/widget/near/196760600" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html#196760600">(May 07 2020 at 12:06)</a>:</h4>
<p>Yes the counter replaces the goal state widget.</p>



<a name="196760646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/widget/near/196760646" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html#196760646">(May 07 2020 at 12:07)</a>:</h4>
<p>But you could easily make a component that shows both the counter and the tactic state</p>



<a name="196760769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/widget/near/196760769" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html#196760769">(May 07 2020 at 12:08)</a>:</h4>
<p>But what does the comment after the <code>split</code> mean?</p>



<a name="196760776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/widget/near/196760776" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html#196760776">(May 07 2020 at 12:08)</a>:</h4>
<p>Should I then see two counters?</p>



<a name="196760777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/widget/near/196760777" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html#196760777">(May 07 2020 at 12:08)</a>:</h4>
<p>There is a separate counter state (the number between buttons) for each command in the block. So if you click between the counters you can observe that the state is preserved, the idea is that you would use this state for ephemeral things like whether a UI menu is open or scroll position or whatever</p>



<a name="196763830"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/widget/near/196763830" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html#196763830">(May 07 2020 at 12:41)</a>:</h4>
<blockquote>
<p>This means that it is possible to make an interactive UI for tactic states (eg you could click on a goal and it would give you a list of available tactics) entirely within lean, without having to write any javascript or C++.</p>
</blockquote>
<p>To flesh this out a little more, how would you implement this "available tactics" example?  Would you write a  "widget" (formally a function of type <code>component tactic_state string</code>) in lean similar to your <code>counter</code> example, but which looks at the tactic_state and then figures out which tactics are applicable (sort of a like many of the current tactics which generate <code>Try it:</code>s).  Then the result of that widget tactic would be printed on the right?</p>



<a name="196764012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/widget/near/196764012" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html#196764012">(May 07 2020 at 12:43)</a>:</h4>
<p>I'm mixing up my types a little.  Can you call tactics from within your widgets (again, functions of type <code>component tactic_state string</code>)?  Maybe you would directly apply the tactic to the tactic_state?</p>



<a name="196764591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/widget/near/196764591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html#196764591">(May 07 2020 at 12:48)</a>:</h4>
<p>Yes that's the rough idea. Since <code>tactic a := tactic_state -&gt; interaction_monad (tactic_state x a)</code> (OWTTE) you can run tactics inside the 'view' method of a component. But you can't output a tactic_state to anywhere, instead you have to get the component to emit a string (as it does in the <code>counter</code> example) which is a command in the begin/end block.</p>



<a name="196765005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/widget/near/196765005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html#196765005">(May 07 2020 at 12:52)</a>:</h4>
<p>There is a helper def <code>widget.mk_tactic_widget</code> for making widgets which use tactics</p>



<a name="196765030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/widget/near/196765030" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html#196765030">(May 07 2020 at 12:52)</a>:</h4>
<p>Yes I just found that.  Makes more sense.</p>



<a name="196765223"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/widget/near/196765223" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html#196765223">(May 07 2020 at 12:53)</a>:</h4>
<p>Also, one big advantage of this over just adding a tactic at the end of your block is that you can delay running this "suggest" tactic (which might be expensive) until the user clicks on the goal (or some button which says "find relevant tactics").  Is that the idea?</p>



<a name="196765485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/widget/near/196765485" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html#196765485">(May 07 2020 at 12:55)</a>:</h4>
<p>Yes. Eg the contents of the type tooltip is not computed until you click on it</p>



<a name="196765673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/widget/near/196765673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/widget.html#196765673">(May 07 2020 at 12:57)</a>:</h4>
<p>currently  there is no support for having a long-running computation in a <code>task a</code> and having the UI update when it is done, so the user experience is not going to be great if there is a long-running comp that is needed before showing the UI</p>



{% endraw %}

<hr><p>Last updated: May 07 2020 at 13:07 UTC</p>