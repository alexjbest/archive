---
layout: archive
title: Zulip Chat Archive
permalink: /stream/113488-general/topic/transitive.20coercions.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/113488-general/index.html">general</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/transitive.20coercions.html">transitive coercions</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="195747861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/transitive%20coercions/near/195747861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/transitive.20coercions.html#195747861">(Apr 29 2020 at 18:02)</a>:</h4>
<p>Here's the first thing which broke in a nontrivial way when I made <code>coe_fn_trans</code> and <code>coe_sort_trans</code> no longer instances:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">lemma</span> <span class="n">Union_range_eq_sUnion</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="bp">*</span><span class="o">}</span> <span class="o">(</span><span class="n">C</span> <span class="o">:</span> <span class="n">set</span> <span class="o">(</span><span class="n">set</span> <span class="n">α</span><span class="o">))</span>
  <span class="o">{</span><span class="n">f</span> <span class="o">:</span> <span class="bp">∀</span><span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">C</span><span class="o">),</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">s</span><span class="o">}</span> <span class="o">(</span><span class="n">hf</span> <span class="o">:</span> <span class="bp">∀</span><span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">C</span><span class="o">),</span> <span class="n">surjective</span> <span class="o">(</span><span class="n">f</span> <span class="n">s</span><span class="o">))</span> <span class="o">:</span>
  <span class="o">(</span><span class="err">⋃</span><span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">β</span><span class="o">),</span> <span class="n">range</span> <span class="o">(</span><span class="bp">λ</span><span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">C</span><span class="o">),</span> <span class="o">(</span><span class="n">f</span> <span class="n">s</span> <span class="n">y</span><span class="o">)</span><span class="bp">.</span><span class="n">val</span><span class="o">))</span> <span class="bp">=</span> <span class="err">⋃₀</span> <span class="n">C</span> <span class="o">:=</span>
</code></pre></div>



<a name="195747954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/transitive%20coercions/near/195747954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/transitive.20coercions.html#195747954">(Apr 29 2020 at 18:03)</a>:</h4>
<p>(By "nontrivial", I mean something not directly related to transitive coercions. Obviously the fix for this example is still simple.)</p>



<a name="195751341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/transitive%20coercions/near/195751341" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/transitive.20coercions.html#195751341">(Apr 29 2020 at 18:31)</a>:</h4>
<p>I recommend explicitly putting in multiple type ascriptions whenever we literally want a transitive coercion</p>



<a name="195797044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/transitive%20coercions/near/195797044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/transitive.20coercions.html#195797044">(Apr 30 2020 at 04:15)</a>:</h4>
<p>I got distracted from this project, but a second class of issues are ones where we define a new type and a <code>has_coe</code> instance for it to another type that has a coercion to function/sort, and expect the new type to also have a coercion to function/sort. A prototypical example is <code>subgroup G</code> which has a coercion to <code>set G</code>. These are easily addressed by adding an explicit <code>has_coe_to_sort</code> instance.</p>



<a name="195810897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/transitive%20coercions/near/195810897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/transitive.20coercions.html#195810897">(Apr 30 2020 at 08:32)</a>:</h4>
<p>These need to be fixed anyhow.  Transitive coercion instances are not in simp-normal form.</p>



<a name="195833474"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/transitive%20coercions/near/195833474" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/transitive.20coercions.html#195833474">(Apr 30 2020 at 12:47)</a>:</h4>
<p>If we want to make this change, it might be handy to write a little attribute we can put on <code>has_coe</code> instances to automatically generate <code>has_coe_to_sort</code>/<code>has_coe_to_fun</code> instances--though they're quite easy to write by hand also: I've been using things like</p>
<div class="codehilite"><pre><span></span><code><span class="kn">instance</span> <span class="o">:</span> <span class="n">has_coe_to_sort</span> <span class="o">(</span><span class="n">submodule</span> <span class="n">R</span> <span class="n">M</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">@</span><span class="n">coe_sort_trans</span> <span class="bp">_</span> <span class="o">(</span><span class="n">set</span> <span class="n">M</span><span class="o">)</span> <span class="bp">_</span> <span class="bp">_</span>
</code></pre></div>


<p>and it seems to be working so far...</p>



<a name="195833586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/transitive%20coercions/near/195833586" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/transitive.20coercions.html#195833586">(Apr 30 2020 at 12:48)</a>:</h4>
<p>In a fancier system, maybe it would be worth thinking of "an R-submodule of M is a set" as a different kind of thing from "a natural number is an integer"</p>



<a name="195833748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/transitive%20coercions/near/195833748" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/transitive.20coercions.html#195833748">(Apr 30 2020 at 12:50)</a>:</h4>
<p>Haha, I briefly panicked when a <code>dsimp</code> in the middle of some random proof stopped working, but I just deleted it and all is well <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p>



<a name="195835973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/transitive%20coercions/near/195835973" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/transitive.20coercions.html#195835973">(Apr 30 2020 at 13:09)</a>:</h4>
<p>Whoa, it builds <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> <br>
<code> 20 files changed, 38 insertions(+), 37 deletions(-)</code></p>



<a name="195836090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/transitive%20coercions/near/195836090" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/transitive.20coercions.html#195836090">(Apr 30 2020 at 13:10)</a>:</h4>
<p>That's actually a rather small diff</p>



<a name="195836124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/transitive%20coercions/near/195836124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/transitive.20coercions.html#195836124">(Apr 30 2020 at 13:10)</a>:</h4>
<p>and a little bit is commenting out things that should just be deleted, so it actually saves a few lines overall</p>



<a name="195836160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/transitive%20coercions/near/195836160" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/transitive.20coercions.html#195836160">(Apr 30 2020 at 13:11)</a>:</h4>
<p>And speeds up the build, I guess</p>



<a name="195836192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/transitive%20coercions/near/195836192" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/transitive.20coercions.html#195836192">(Apr 30 2020 at 13:11)</a>:</h4>
<p>But probably not noticable</p>



<a name="195838136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/transitive%20coercions/near/195838136" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/transitive.20coercions.html#195838136">(Apr 30 2020 at 13:28)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/commit/8ef91f54a9c689f2560b8670e573bb3a79d15940" title="https://github.com/leanprover-community/mathlib/commit/8ef91f54a9c689f2560b8670e573bb3a79d15940">Here</a> is the commit if anyone is interested; there are some bits like the <code>has_coe_to_fun_linter</code> which I don't understand yet.</p>



<a name="195838160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/transitive%20coercions/near/195838160" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/transitive.20coercions.html#195838160">(Apr 30 2020 at 13:29)</a>:</h4>
<p>I assume it doesn't build with the current version of Lean, but I suppose it might</p>



<a name="195838361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/transitive%20coercions/near/195838361" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/transitive.20coercions.html#195838361">(Apr 30 2020 at 13:30)</a>:</h4>
<p>Ah, the CI build failed immediately because of my change to <code>leanpkg.toml</code>--probably for the best <span aria-label="slight smile" class="emoji emoji-1f642" role="img" title="slight smile">:slight_smile:</span></p>



<a name="195841201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/transitive%20coercions/near/195841201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/113488-general/topic/transitive.20coercions.html#195841201">(Apr 30 2020 at 13:50)</a>:</h4>
<p>The <code>has_coe_to_fun</code> linter is supposed to check for exactly this kind of problem, where a type has a <code>has_coe</code> instance but no <code>has_coe_to_fun</code>.  If the transitive instances are gone, then the linter is no longer necessary.</p>



{% endraw %}

<hr><p>Last updated: Apr 30 2020 at 23:04 UTC</p>